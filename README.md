# Введение
Спасибо за тестовое :) Получилось побольше узнать об авторизации.

# Сервис авторизации
## Необходимо для запуска
- Docker
- Make
## Как запустить
Для запуска воспользуйтесь:

`make run`

Это запустит Docker swarm в котором Postgres, MailHog (для тестирования емейла) и сам сервис. Сервис будет доступен на порту 8888. На запуск требуется примерно 30 секунд.

Если нужно остановить:

`make stop`

Ещё можно тесты запустить отдельно, если надо:

`make .test`

И линтером прогнать:

`make lint`

## Примеры запросов
Генерация токенов `curl --location 'http://localhost:8888/api/auth/generate?user_guid=999'`

![image](https://github.com/user-attachments/assets/d6f3c93c-15e2-4b9e-8349-f4d1c9daefaa)
Повторная попытка генерации токенов для того же пользователя вернет ошибку 400 "user already has access token"
![image](https://github.com/user-attachments/assets/7f44e0b4-384f-49fa-af86-3052af404a17)

Сгенерируем для другого пользователя `curl --location 'http://localhost:8888/api/auth/generate?user_guid=875'`

![image](https://github.com/user-attachments/assets/26f5b977-33dd-46c5-8c2a-3e38d5d2007e)
Обновим токены
![image](https://github.com/user-attachments/assets/cfd5ba85-0ba6-4d81-8141-16df1318e0f8)
Попытка обновить тем же рефреш токеном вернет ошибку 400 "this token invalid"
![image](https://github.com/user-attachments/assets/8a26655d-91a0-40b0-a793-fe8c0188b825)

Попытка обновить НЕ его рефреш токеном тоже вернет ошибку 400 "this token invalid"
![image](https://github.com/user-attachments/assets/1f2e2eeb-f471-4649-bb43-0e3a5fb52046)


## Отправка предупреждения на email
Решил использовать MailHog как SMTP сервер для локального тестирования. Сообщения приходят :)
![image](https://github.com/user-attachments/assets/2f3178cc-908c-456d-8d0e-2429bc8f3538)
В сообщении указан конкретный ip, с которого был выполнен рефреш. И IP и Email - моковые
![image](https://github.com/user-attachments/assets/a53b23fa-9d68-4544-9fac-2ae3845787e1)

## Передача подписи jwt
Секретный ключ jwt я записываю в Docker secret, прокидываю его через compose и корректно достаю из приложения. Всё для безопасности ключа.
А потом в мейк файле явно его создаю, чем невелирую все предпринятые шаги по обеспечению безопасонсти :))

В реальном проекте я бы так не поступал, но здесь это сделано исключительно ради удобства и ускорения проверки.

## Проверка существования пользователей
Я не стал реализовывать проверку на существование данного пользователя, потому что 
- в реализации это вопрос одного селекта
- но придётся делать дополнительные ручки, либо каждый раз лазать в базу руками, чтобы создать\посмотреть пользователя. А это время
